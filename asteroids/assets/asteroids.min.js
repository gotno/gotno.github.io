(function(e){var t=e.Asteroids=e.Asteroids||{};Function.prototype.inherits=function(e){var t=function(){};t.prototype=e.prototype;this.prototype=new t};Math.degToRad=function(e){return e*(Math.PI/180)};Math.roundTo=function(e,t){var n=Math.pow(10,t);e*=n;e=Math.round(e);e/=n;return e}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Point=function(e){this.pos={x:0,y:0};this.radius=e.radius;this.setOrigin(e.origin);this.setAngle(-e.angle)};n.prototype.setAngle=function(e){this.angle=Math.roundTo(e,4)};n.prototype.getAngle=function(){return this.angle};n.prototype.setOrigin=function(e){this.origin=$.extend({},e);this.updatePos()};n.prototype.rotate=function(e){this.setAngle(this.getAngle()-e);this.updatePos()};n.prototype.updatePos=function(){var e=this.origin.x+this.radius,t=this.origin.y,n=this.origin.x,r=this.origin.y,i=this.angle;var s=Math.cos(i)*(e-n)-Math.sin(i)*(t-r)+n,o=Math.sin(i)*(e-n)+Math.cos(i)*(t-r)+r;this.pos.x=s;this.pos.y=o}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.MovingObject=function(e){this.pos=e.pos;this.vel=e.vel;this.radius=e.radius;this.angle=e.angle;this.rotationSpeed=e.rotationSpeed||0;this.color=e.color;this.emitters=[]};n.prototype.draw=function(e){this.emitters.forEach(function(e){e.particleStep()});if(this.radius!==0){e.strokeStyle=this.color;e.lineWidth=.5;e.beginPath();e.arc(this.pos.x,this.pos.y,this.radius+1,0,2*Math.PI);e.stroke()}};n.prototype.isCollidedWith=function(e){var t=Math.pow(this.pos.x-e.pos.x,2);var n=Math.pow(this.pos.y-e.pos.y,2);var r=Math.sqrt(t+n);return this.radius+e.radius>r};n.prototype.move=function(){this.pos.x+=this.vel.x;this.pos.y+=this.vel.y;this.rotate(this.rotationSpeed);var e=this;this.emitters.forEach(function(t){t.setOrigin($.extend({},e.pos))})};n.prototype.rotate=function(e){this.angle-=e;var t=this;this.emitters.forEach(function(t){t.rotate(e)})};n.prototype.attachEmitter=function(e,n,r,i){var e=$.extend(true,{},e);e.ctx=n;e.point.origin=$.extend({},this.pos);e.point.radius=r;e.point.angle=this.angle+i;var s=new t.Emitter(e);this.emitters.push(s);return s}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};t.MovingObjectPointed=function(e){t.MovingObject.call(this,e);this.points=e.points;this.strokeColor=e.strokeColor||null};var n=t.MovingObjectPointed;n.inherits(t.MovingObject);n.prototype.draw=function(e){if(this.points.length>0){e.beginPath();e.moveTo(this.points[0].pos.x,this.points[0].pos.y);for(var t=1;t<this.points.length;t++){e.lineTo(this.points[t].pos.x,this.points[t].pos.y)}e.lineTo(this.points[0].pos.x,this.points[0].pos.y);e.fillStyle=this.color;e.fill();if(this.strokeColor){e.strokeStyle=this.strokeColor;e.lineWidth=2;e.stroke()}}};n.prototype.rotate=function(e){t.MovingObject.prototype.rotate.call(this,e);this.points.forEach(function(t){t.rotate(e)})};n.prototype.move=function(e){t.MovingObject.prototype.move.call(this);var n=this;this.points.forEach(function(e){e.setOrigin(n.pos)})}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Game=function(e){this.switchModes("start");this.ctx=e;this.HUD=new t.HUD(e);this.HUD.getHighScores();this.addKeyBindings();this.startScreen()};n.prototype.setup=function(){this.asteroids=[];this.emitterObjects=[];this.ship=new t.Ship({x:n.DIM_X/2,y:n.DIM_Y/2},this.ctx);this.bullets=[];this.score=0;this.addAsteroids(10)};n.prototype.startScreen=function(){this.asteroids=[];this.bullets=[];this.emitterObjects=[];this.ship=new t.Ship({x:n.DIM_X/2,y:n.DIM_Y/2},this.ctx);this.ship.exhaustEmitter.throttle=true;this.addStartAsteroids(24)};n.prototype.reset=function(){this.asteroids.forEach(function(e){delete e});this.bullets.forEach(function(e){delete e});delete this.ship;this.emitterObjects.forEach(function(e){delete e});this.setup()};n.prototype.switchModes=function(e){this.mode=e;key.setScope(e)};n.prototype.addSmallAsteroids=function(e,n,r){for(var i=0;i<e;i++){var s=t.Asteroid.randomSmallAsteroid(n,r);this.asteroids.push(s)}};n.prototype.addAsteroids=function(e){for(var r=0;r<e;r++){this.asteroids.push(t.Asteroid.randomAsteroid(n.DIM_X,n.DIM_Y))}};n.prototype.addStartAsteroids=function(){for(var e=0;e<20;e++){this.asteroids.push(t.Asteroid.randomStartAsteroid(n.DIM_X,n.DIM_Y))}};n.prototype.draw=function(){var e=this.ctx;e.fillStyle=n.colors.bg;e.fillRect(0,0,n.DIM_X,n.DIM_Y);this.asteroids.forEach(function(t){t.draw(e)});this.bullets.forEach(function(t){t.draw(e)});this.emitterObjects.forEach(function(t){t.draw(e)});this.ship.draw(e);switch(this.mode){case"start":this.HUD.drawStartScreen();break;case"inPlay":this.HUD.drawInPlay(this.score);break;case"over":this.HUD.drawGameOver(this.score);break}};n.prototype.move=function(){var e=this;this.asteroids.forEach(function(t){t.move();e.screenWrap(t)});this.ship.move();this.screenWrap(this.ship);var t=[];this.bullets.forEach(function(n){n.move();if(e.isOnScreen(n)){t.push(n)}});this.bullets=t;this.emitterObjects.forEach(function(e){e.move()})};n.prototype.screenWrap=function(e){if(e.pos.x+e.radius<0&&e.vel.x<0){e.pos.x=n.DIM_X+e.radius}if(e.pos.x-e.radius>n.DIM_X&&e.vel.x>0){e.pos.x=-e.radius}if(e.pos.y+e.radius<0&&e.vel.y<0){e.pos.y=n.DIM_Y+e.radius}if(e.pos.y-e.radius>n.DIM_Y&&e.vel.y>0){e.pos.y=-e.radius}};n.prototype.isOnScreen=function(e){if(e.pos.x+e.radius<0||e.pos.x-e.radius>n.DIM_X||e.pos.y+e.radius<0||e.pos.y-e.radius>n.DIM_Y){return false}return true};n.prototype.step=function(){if(this.mode=="inPlay"){this.checkKeyPresses();this.checkCollisions()}this.move();this.draw()};n.prototype.checkKeyPresses=function(){if(key.isPressed("up"))this.ship.impulse();if(key.isPressed("left"))this.ship.rotate(Math.degToRad(10));if(key.isPressed("right"))this.ship.rotate(Math.degToRad(-10))};n.prototype.addKeyBindings=function(){var e=this;key("space","inPlay",function(){e.fireBullet()});key("a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,backspace","over",function(t,n){e.HUD.input(n.shortcut)});key("enter","over",function(){if(e.HUD.mode==="input"){e.HUD.submit(e.score)}else{e.stop();e.reset();e.setup();e.start();e.switchModes("inPlay")}});key("enter","start",function(){e.stop();e.reset();e.setup();e.start();e.switchModes("inPlay")})};n.prototype.checkCollisions=function(){var e=this;this.asteroids.forEach(function(t,n){if(t.isCollidedWith(e.ship)){e.switchModes("over");e.ship.destroy();console.log(this.mode);if(e.HUD.isHighScore(e.score)){e.HUD.switchModes("input")}}if(e.bullets.length>0){e.bullets.forEach(function(r,i){if(t.isCollidedWith(r)){e.handleBulletHit(n,i)}})}})};n.prototype.fireBullet=function(){if(this.bullets.length<n.MAX_BULLETS){var e=this.ship.fireBullet();if(e){this.bullets.push(e)}}};n.prototype.handleBulletHit=function(e,t){var r=this.asteroids[e];var i=this.bullets[t];if(!r.isSmall()){var s=1+Math.ceil(Math.random()*2);this.addSmallAsteroids(s,$.extend({},r),$.extend({},i));this.score+=1}else{var s=1+Math.ceil(Math.random()*2);this.addAsteroids(s);this.score+=2}this.addEmitterObject({pos:{x:i.pos.x,y:i.pos.y},vel:{x:0,y:0},radius:0,angle:0,rotationSpeed:Math.degToRad(30)},n.bulletExplosionEmitter);delete this.asteroids[e];this.asteroids.splice(e,1);delete this.bullets[t];this.bullets.splice(t,1)};n.prototype.start=function(){var e=this;this.interval=setInterval(function(){e.step()},n.INTERVAL_MILLISECONDS)};n.prototype.stop=function(){clearInterval(this.interval)};n.prototype.addEmitterObject=function(e,n){var r=new t.MovingObject(e);this.emitterObjects.push(r);var i=r.attachEmitter(n,this.ctx,0,0);var i=r.attachEmitter(n,this.ctx,0,Math.PI*2*.333);var i=r.attachEmitter(n,this.ctx,0,Math.PI*2*.666)};n.colors={bg:"#123234"};n.INTERVAL_MILLISECONDS=30;n.DIM_X=800;n.DIM_Y=600;n.MAX_BULLETS=5;n.bulletExplosionEmitter={point:{origin:{},radius:0,angle:0},emitter:{vel:{x:6,y:6,wobble:{amt:6,weight:0}},rate:{num:1,wobble:{amt:0,weight:0}},radius:{radius:12,wobble:{amt:4,weight:0}},sputter:50,layers:2,throttle:true,lifespan:5},particles:{vel:{decay:{amt:.8,weight:0,limit:.1}},radius:{radius:7,decay:{amt:.95,weight:0,limit:0}},angle:0,lifespan:{span:20,wobble:{amt:5,weight:1}},lifeline:{attr:"radius",val:"radius",trigger:0},layers:[{color:"#952933",radiusOffset:0},{color:"#abef86",radiusOffset:3}]}}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.HUD=function(e){this.ctx=e;this.highScores=[];this.switchModes("normal")};n.prototype.switchModes=function(e){switch(e){case"normal":this.mode=e;break;case"input":this.mode=e;this.userInput="";break}};n.prototype.isHighScore=function(e){if(this.highScores.length<10&&e>0){return true}else if(e>this.highScores[this.highScores.length-1].score){return true}return false};n.prototype.drawStartScreen=function(){var e=this.ctx;var n=t.Game.DIM_X;var r=t.Game.DIM_Y;e.fillStyle="rgba(0, 0, 0, 0.2)";e.fillRect(0,0,n,r);e.fillStyle="#abef86";e.font="bold 64px sans-serif";e.textBaseLine="middle";e.textAlign="center";e.fillText("INFINITE ASTEROIDS",n/2,r/2-25);e.font="bold 18px sans-serif";e.fillText("press [ enter ] to start",n/2,r/2+70);var i="[ < ] + [ > ] to rotate   |   ";i+="[ ^ ] to thrust   |   ";i+="[ space ] to shoot";e.font="bold 14px sans-serif";e.fillText("controls:",n/2,r/2+230);e.fillText(i,n/2,r/2+250)};n.prototype.drawInPlay=function(e){var n=this.ctx;var r="score: "+e;n.fillStyle="#abef86";n.font="bold 24px sans-serif";n.textBaseLine="top";n.textAlign="right";n.fillText(r,t.Game.DIM_X-20,30)};n.prototype.drawHighScores=function(){var e=this.ctx;var n=t.Game.DIM_X;var r=t.Game.DIM_Y;e.fillStyle="rgba(0, 0, 0, 0.2)";var i=n-290;var s=125;var o=250;var u=r-s*2;e.fillRect(i,s,o,u);var a=i+o/2;var f=s+30;e.fillStyle="#FF4657";e.font="bold 20px sans-serif";e.textBaseLine="middle";e.textAlign="center";e.fillText("HIGH SCORES",a,f);e.font="bold 18px sans-serif";e.textBaseLine="middle";e.textAlign="left";a=a-80;for(var l=0;l<this.highScores.length;l++){f+=30;var c=this.highScores[l].initials;var h=this.highScores[l].score;e.textAlign="left";e.fillText(c,a,f);e.textAlign="right";e.fillText(h,a+155,f)}};n.prototype.drawGameOver=function(e){var n=this.ctx;var r=t.Game.DIM_X;var i=t.Game.DIM_Y;var s="score: "+e;n.fillStyle="rgba(0, 0, 0, 0.2)";n.fillRect(0,0,r,i);n.fillStyle="#abef86";n.font="bold 24px sans-serif";n.textBaseLine="middle";n.textAlign="center";n.fillText("GAME OVER",r/2,i/2-20);n.fillText(s,r/2,i/2+20);if(this.mode=="normal"){n.font="bold 16px sans-serif";n.fillText("press enter to restart",r/2,i/2+60)}this.drawHighScores();if(this.mode=="input")this.drawInput()};n.prototype.drawInput=function(){var e=this.ctx;var n=t.Game.DIM_X;var r=t.Game.DIM_Y;e.fillStyle=t.Ship.COLOR;e.font="bold 28px sans-serif";e.textBaseLine="middle";e.textAlign="center";e.fillText("YOU HAVE DIED AN HONORABLE DEATH",n/2,r/2-190);e.fillStyle=t.Asteroid.STROKE_COLOR;var i="";for(var s=0;s<3;s++){i+=this.userInput[s]?this.userInput[s]:"_";i+=s!==2?" ":""}e.fillText(i,n/2,r/2-155);e.fillStyle=t.Ship.COLOR;e.font="bold 16px sans-serif";e.fillText("Input your call sign and",n/2,r/2-125);e.fillText("strike ENTER to join",n/2,r/2-105);e.fillText("the ranks of the elite.",n/2,r/2-85)};n.prototype.getHighScores=function(){var e="https://api.mongolab.com/api/1/databases/asteroids/collections/highscores";var t="?apiKey=tc8u4QBd0dzTTyTp34UdPJtrlHLJVnIk";t+='&s={"score": -1}';t+="&l=10";var n=this;$.ajax({url:e+t,type:"GET",dataType:"json",success:function(e){n.highScores=e}})};n.prototype.addHighScore=function(e){var t="https://api.mongolab.com/api/1/databases/asteroids/collections/highscores";var n="?apiKey=tc8u4QBd0dzTTyTp34UdPJtrlHLJVnIk";var r=this;$.ajax({url:t+n,type:"POST",data:JSON.stringify(e),contentType:"application/json",success:function(){r.getHighScores()}})};n.prototype.input=function(e){var t=this.userInput;if(e==="backspace"&&t.length>0){this.userInput=t.substring(0,t.length-1)}else if(e!=="backspace"&&t.length<3){this.userInput+=e.toUpperCase()}};n.prototype.submit=function(e){if(this.userInput.length===3){this.addHighScore({initials:this.userInput,score:e});this.switchModes("normal")}}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Asteroid=function(e){t.MovingObjectPointed.call(this,e);this.crosslineIndices=e.crosslineIndices};n.inherits(t.MovingObjectPointed);n.COLOR="#952933";n.STROKE_COLOR="#FF4657";n.SMALL_RADIUS=32;n.RADIUS=64;n.randomSmallAsteroid=function(e,t){var r={};r.radius=e.radius/2;r.radius+=Math.random()*(e.radius/4);r.radius-=e.radius/8;r.radius=Math.round(r.radius);r.pos=n.randomInsidePos(e.pos.x,e.pos.y);r.points=n.generatePoints(r.pos,r.radius);r.vel={};if(e.vel.x>0){r.vel.x=Math.random()*e.vel.x;r.vel.x+=Math.random()*e.vel.x}else{r.vel.x=-(Math.random()*e.vel.x);r.vel.x-=Math.random()*e.vel.x}if(e.vel.y>0){r.vel.y=Math.random()*e.vel.y;r.vel.y+=Math.random()*e.vel.y}else{r.vel.y=-(Math.random()*e.vel.y);r.vel.y-=Math.random()*e.vel.y}r.vel.x+=Math.random()*(t.vel.x/6);r.vel.y+=Math.random()*(t.vel.y/6);r.color=n.COLOR;r.strokeColor=n.STROKE_COLOR;var i=Math.roundTo(Math.random()*1.5-.75,2);r.rotationSpeed=Math.degToRad(i);r.crosslineIndices=n.generateCrosslineIndices(r.points.length);return new n(r)};n.randomAsteroid=function(e,t){var r={};r.pos={};r.radius=n.randomRadius(n.RADIUS);r.pos=n.randomOutsidePos(e,t);r.points=n.generatePoints(r.pos,r.radius);r.vel={};r.vel.x=n.randomVel();r.vel.y=n.randomVel();r.color=n.COLOR;r.strokeColor=n.STROKE_COLOR;var i=Math.roundTo(Math.random()*1.5-.75,2);r.rotationSpeed=Math.degToRad(i);r.crosslineIndices=n.generateCrosslineIndices(r.points.length);return new n(r)};n.randomStartAsteroid=function(e,t){var r={};r.pos={};r.radius=n.randomRadius(n.RADIUS);r.pos=n.randomStartScreenPos(e,t);r.points=n.generatePoints(r.pos,r.radius);r.vel={};r.vel.x=0;r.vel.y=Math.random()*4+2;r.color=n.COLOR;r.strokeColor=n.STROKE_COLOR;var i=Math.roundTo(Math.random()*1.5-.75,2);r.rotationSpeed=Math.degToRad(i);r.crosslineIndices=n.generateCrosslineIndices(r.points.length);return new n(r)};n.prototype.draw=function(e){t.MovingObjectPointed.prototype.draw.call(this,e);var n=this;this.crosslineIndices.forEach(function(t){e.beginPath();var r=n.points[t[0]];e.moveTo(r.pos.x,r.pos.y);r=n.points[t[1]];e.lineTo(r.pos.x,r.pos.y);e.stroke()})};n.prototype.isSmall=function(){if(this.radius<n.SMALL_RADIUS){return true}return false};n.generateCrosslineIndices=function(e){var t=[];var n=Math.floor(Math.random()*e);var r=Math.ceil(Math.random()*2)+1+n;r%=e;t.push([n,r]);r=r+1+Math.round(Math.random()*1);r%=e;t.push([n,r]);return t};n.generatePoints=function(e,n){var r=7+Math.floor(Math.random()*4);var i=Math.roundTo(2*Math.PI/r,2);var s=Math.roundTo(Math.degToRad(15),2);var o=0;var u=0;var a=[];for(var f=0;f<r;f++){u=Math.random()*s-s/2;o+=i+s;if(o>Math.PI*2||f==r-1){o=0}a.push(new t.Point({origin:e,radius:n,angle:o}))}return a};n.randomInsidePos=function(e,t){var n={};n.x=e+Math.round(Math.random()*32-16);n.y=t+Math.round(Math.random()*32-16);return n};n.randomStartScreenPos=function(e,t){var r={};r.y=-n.RADIUS-Math.random()*n.RADIUS*2;r.x=e/2;while(r.x>e/2-80&&r.x<e/2+80){r.x=Math.random()*e}return r};n.randomOutsidePos=function(e,t){var r={};var i=n.RADIUS/2+Math.random()*n.RADIUS*5;i=Math.round(i);var s=n.RADIUS/2+Math.random()*n.RADIUS*5;s=Math.round(s);if(Math.random()<.5){r.x=-i}else{r.x=e+i}if(Math.random()<.5){r.y=-s}else{r.y=t+s}return r};n.randomVel=function(){return Math.random()*4-2};n.randomRadius=function(e){return Math.random()*(e/2)+e/2}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Ship=function(e,r){var i={};i.pos=e;i.vel={x:0,y:0};i.radius=n.RADIUS;i.color=n.COLOR;i.angle=Math.PI;this.ctx=r;i.points=[new t.Point({origin:$.extend({},e),radius:n.RADIUS,angle:Math.PI/2}),new t.Point({origin:$.extend({},e),radius:n.RADIUS,angle:Math.PI/2+Math.degToRad(130)}),new t.Point({origin:$.extend({},e),radius:0,angle:0}),new t.Point({origin:$.extend({},e),radius:n.RADIUS,angle:Math.PI/2-Math.degToRad(130)})];t.MovingObjectPointed.call(this,i);this.exhaustEmitter=this.attachEmitter(n.exhaustEmitterOptions,r,20,Math.PI/2)};n.inherits(t.MovingObjectPointed);n.prototype.impulse=function(e,t){this.vel.x+=Math.sin(this.angle-Math.PI)*n.IMPULSE;this.vel.y+=-Math.cos(this.angle-Math.PI)*n.IMPULSE;this.exhaustEmitter.emit()};n.prototype.fireBullet=function(e){var r={};r.pos=$.extend({},this.pos);r.vel={};r.vel.x=Math.sin(this.angle-Math.PI)*n.BULLET_SPEED;r.vel.y=-Math.cos(this.angle-Math.PI)*n.BULLET_SPEED;var i=new t.Bullet(r);return i};n.prototype.draw=function(e){this.emitters.forEach(function(e){e.particleStep()});t.MovingObjectPointed.prototype.draw.call(this,e)};n.prototype.destroy=function(){delete this.exhaustEmitter;this.emitters=[];this.points=[];this.rotationSpeed=Math.degToRad(30);this.attachEmitter(n.explosionEmitterOptions,this.ctx,0,0);this.attachEmitter(n.explosionEmitterOptions,this.ctx,0,Math.PI*2*.333);this.attachEmitter(n.explosionEmitterOptions,this.ctx,0,Math.PI*2*.666)};n.RADIUS=8;n.IMPULSE=.2;n.BULLET_SPEED=12;n.COLOR="#7dabca";n.explosionEmitterOptions={point:{origin:{},radius:0,angle:0},emitter:{vel:{x:6,y:6,wobble:{amt:4,weight:0}},rate:{num:3,wobble:{amt:1,weight:0}},radius:{radius:14,wobble:{amt:4,weight:0}},sputter:20,layers:2,throttle:true,lifespan:15},particles:{vel:{decay:{amt:.7,weight:0,limit:.1}},radius:{radius:0,decay:{amt:.95,weight:0,limit:0}},angle:0,rotationSpeed:0,lifespan:{span:20,wobble:{amt:5,weight:1}},lifeline:{attr:"radius",val:"radius",trigger:0},layers:[{color:t.Asteroid.COLOR,radiusOffset:0},{color:n.COLOR,radiusOffset:-1}]}};n.exhaustEmitterOptions={point:{origin:{},radius:0,angle:0},emitter:{vel:{x:6,y:6,wobble:{amt:4,weight:0}},rate:{num:3,wobble:{amt:1,weight:0}},radius:{radius:10,wobble:{amt:2,weight:0}},sputter:20,layers:2,lifespan:-1},particles:{vel:{decay:{amt:.7,weight:0,limit:.1}},radius:{radius:0,decay:{amt:.95,weight:0,limit:0}},angle:0,rotationSpeed:0,lifespan:{span:20,wobble:{amt:5,weight:1}},lifeline:{attr:"radius",val:"radius",trigger:0},layers:[{color:"#fcfcfc",radiusOffset:0},{color:n.COLOR,radiusOffset:-2}]}}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Bullet=function(e){e.radius=n.RADIUS;e.color=n.COLOR;t.MovingObject.call(this,e)};n.inherits(t.MovingObject);n.RADIUS=2;n.COLOR="#abef86"})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Emitter=function(e){var n=e.point;t.Point.call(this,n);this.eOpts=e.emitter;this.cold=false;this.throttle=this.eOpts.throttle||false;this.lifespan=this.eOpts.lifespan||-1;this.pOpts=e.particles;this.ctx=e.ctx;this.particles=[]};n.inherits(t.Point);n.prototype.emit=function(){var e=this.eOpts,r=this.pOpts;if(Math.random()*100>e.sputter){var i=n.wobbleValues(e.rate).num;for(var s=0;s<i;s++){var o={};var u=n.wobbleValues(e.vel);o.x=Math.sin(this.angle+Math.PI/2)*u.x;o.y=-Math.cos(this.angle+Math.PI/2)*u.y;o.decay=r.vel.decay;var a=n.wobbleValues(e.radius);a.decay=r.radius.decay;var f=n.wobbleValues(e.lifespan);f.span=Math.round(f.span);this.particles.push(new t.Particle({pos:$.extend({},this.pos),vel:o,angle:this.angle,rotationSpeed:r.rotationSpeed,radius:a,lifespan:f,lifeline:r.lifeline,layers:r.layers}))}}};n.prototype.particleStep=function(){if(this.lifespan!==0){if(this.throttle)this.emit();this.lifespan--}else if(this.lifespan===0){this.throttle=false}var e=this;if(this.particles.length>0){this.cold=false;for(var t=0;t<this.pOpts.layers.length;t++){this.particles.forEach(function(n,r){n.decay();n.move();n.draw(t,e.ctx);if(t==e.pOpts.layers.length-1){e.possibleDeath(r)}})}}else{this.cold=true}};n.prototype.possibleDeath=function(e){var t=this.particles[e];var n=t.lifeline.attr;var r=t.lifeline.val;if(t[n][r]==t.lifeline.trigger){delete this.particles[e];this.particles.splice(e,1);return true}};n.wobbleValues=function(e){wobbledVals={};for(var t in e){if(typeof e[t]==="object")continue;switch(e.wobble.weight){case-1:wobbledVals[t]=e[t]-Math.random()*e.wobble.amt;break;case 0:var n=e.wobble.amt;wobbledVals[t]=e[t];wobbledVals[t]+=Math.random()*n-Math.random()*n;break;case 1:wobbledVals[t]=e[t]+Math.random()*e.wobble.amt;break}}return wobbledVals}})(this);(function(e){var t=e.Asteroids=e.Asteroids||{};var n=t.Particle=function(e){var n=e.radius;e.radius=e.radius.radius;t.MovingObject.call(this,e);this.radius=n;this.lifespan=e.lifespan;this.lifeline=e.lifeline;this.layers=e.layers};n.inherits(t.MovingObject);n.prototype.decay=function(){this.lifespan--;this.vel.x*=this.vel.decay.amt;this.vel.y*=this.vel.decay.amt;n.decayValues(this.radius)};n.prototype.draw=function(e,t){var e=this.layers[e];t.fillStyle=e.color;t.beginPath();var n=this.radius.radius+e.radiusOffset;if(n<0)n=0;t.arc(this.pos.x,this.pos.y,n,0,2*Math.PI);t.fill()};n.decayValues=function(e){for(var t in e){if(typeof e[t]==="object")continue;switch(e.decay.weight){case-1:if(e[t]>e.decay.limit){e[t]-=e.decay.amt}else{e[t]=e.decay.limit}break;case 0:if(e[t]<e.decay.limit+.5){e[t]=e.decay.limit}else{e[t]*=e.decay.amt}break;case 1:if(e[t]>e.decay.limit){e[t]+=e.decay.amt}else{e[t]=e.decay.limit}break;default:e[t]*=e.decay.amt;if(e[t]>e.decay.limit){e[t]=e.decay.limit}}}}})(this)
